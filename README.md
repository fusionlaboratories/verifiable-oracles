# verifiable-oracles

Implementation of Verifiable Oracles on top of Cosmos SDK.

## Project layout

Project contents

- `.vscode/` Visual Studio Code-specific stuff,
  - `extensions.json` recommended extensions,
  - `settings.json` workspace settings,
- `cmd/` CLI commands
  - `ganache/` ganache client PoC,
- `nix/` nix-specific stuff,
- `pkg/` golang packages,
- [`chain/`](#cosmossdk-chain) example CosmosSDK chain.

## Goldilocks field implementation

`pkgs/goldilocks` contains a Goldilocks field implementation generated by
`goff`.  It was generated using:

```bash
$ go get github.com/consensys/gnark-crypto/field/goff 
$ go run github.com/consensys/gnark-crypto/field/goff -m 0xffffffff00000001 -o ./pkg/goldilocks/ -p goldilocks -e Element

running goff version v0.8.0

generating pkg/goldilocks/element.go
generating pkg/goldilocks/vector.go
generating pkg/goldilocks/arith.go
generating pkg/goldilocks/element_test.go
generating pkg/goldilocks/vector_test.go
generating pkg/goldilocks/element_ops_purego.go
generating pkg/goldilocks/doc.go
```

We then cleanup the `go.mod` using

```bash
$ go mod tidy
$
```

## devenv

We use [devenv](https://devenv.sh/getting-started/) for specifying the
development environment. It can be either activated using `direnv` or `devenv
shell`.

## Integration Tests with Ganache

CI job is set up to start `ganache` in deterministic mode running on
`127.0.0.1:8545`.  You can manualy start your own instance by using `devenv up`.

1. Start `ganache` in a deterministic mode in a separate terminal window.  It
should bind to localhost (`127.0.0.1`) and its default port (`8545`).  You can
either start the `ganache` process directly

    ```sh
    $ ganache --wallet.deterministic=true
    ganache v7.9.0 (@ganache/cli: 0.10.0, @ganache/core: 0.10.0)
    Starting RPC server
    ...
    ```

    or you can use `devenv up` to start ganache process for you

    ```sh
    $ devenv up
    17:07:58 system    | ganache.1 started (pid=53000)
    17:07:58 ganache.1 | ganache v7.9.0 (@ganache/cli: 0.10.0, @ganache/core: 0.10.0)
    17:07:58 ganache.1 | Starting RPC server
    ...
    ```

2. Run `go test ./... -tags=integration` to run integration tests

    ```sh
    $ go test ./... -tags=integration
    ok      github.com/qredo/verifiable-oracles (cached)
    ok      github.com/qredo/verifiable-oracles/ganache (cached)
    ```

## CosmosSDK Chain

`chain/` directory contains a CosmosSDK chain created by

```sh
ignite scaffold chain github.com/qredo/verifiable-oracles/chain \
                      --clear-cache \
                      --no-module \
                      --skip-git \
                      --address-prefix voc
```
